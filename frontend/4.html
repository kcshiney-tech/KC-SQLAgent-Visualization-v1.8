<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>故障数统计图表</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- 配置Tailwind自定义样式 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        dark: '#1E293B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .chart-container {
                position: relative;
                height: 70vh;
                width: 100%;
            }
            .x-axis-label {
                writing-mode: vertical-rl;
                text-orientation: mixed;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-dark">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- 标题区域 -->
        <div class="mb-8 text-center">
            <h1 id="chart-title" class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-2"></h1>
            <p class="text-gray-600">基于提供的TXT数据生成的故障数分布图表</p>
        </div>
        
        <!-- 图表容器 -->
        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-8">
            <div class="chart-container">
                <canvas id="faultChart"></canvas>
            </div>
        </div>
        
        <!-- 数据输入区域 -->
        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
            <h2 class="text-xl font-semibold mb-4">数据输入</h2>
            <p class="text-gray-600 mb-4">请在下方文本框中输入符合格式的JSON数据：</p>
            <div class="mb-4">
                <textarea id="dataInput" class="w-full h-64 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="在此输入JSON数据..."></textarea>
            </div>
            <button id="renderBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-all flex items-center">
                <i class="fa fa-refresh mr-2"></i> 渲染图表
            </button>
        </div>
    </div>

    <script>
        // 初始化图表
        let faultChart = null;
        
        // 示例数据 - 会被文本框中的数据替换
        const defaultData = {
            "title": "2025年10月各周不同集群AOC故障数分布",
            "xLabel": "集群.AOC型号.厂商",
            "yLabel": "故障数",
            "labels": [
                "ROCE-TOR下联-QHDX03.400G_AOC_QSFP112.SONT",
                "ROCE-TOR下联-QYYD05.400G_BASE_SR4_QSFPDD.TRILIGHT",
                "ROCE-TOR下联-QYYD06.400G_AOC_QSFP112.SONT",
                "ROCE-TOR下联-QYZNJ01.400G_BASE_SR4_QSFP112.TRILIGHT",
                "ROCE-TOR下联-QHDX03.400G_AOC_QSFP112.SONT",
                "ROCE-TOR下联-QYYD05.400G_BASE_SR4_QSFPDD.TRILIGHT",
                "ROCE-TOR下联-QYYD05.AOC_QSFPDD.Crealights",
                "ROCE-TOR下联-QYZNJ01.400G_BASE_SR4_QSFP112.TRILIGHT",
                "SROCE-TOR下联-QYZNJ01.AOC_QSFPDD.Crealights",
                "ROCE-TOR下联-QHDX01.400G_BASE_VR4_QSFP112.TRILIGHT",
                "ROCE-TOR下联-QYYD05.400G_BASE_SR4_QSFPDD.TRILIGHT",
                "ROCE-TOR下联-QYZNJ01.400G_AOC_QSFP112.Crealights",
                "ROCE-TOR下联-QYYD05.400G_BASE_SR4_QSFPDD.TRILIGHT",
                "ROCE-TOR下联-QYZNJ01.400G_BASE_SR4_QSFP112.TRILIGHT"
            ],
            "values": [
                {
                    "data": [1, 3, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    "label": "第39周"
                },
                {
                    "data": [1, 0, 0, 0, 1, 7, 1, 3, 1, 0, 0, 0, 0, 0],
                    "label": "第40周"
                },
                {
                    "data": [0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 4, 1, 0, 0],
                    "label": "第41周"
                },
                {
                    "data": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1],
                    "label": "第42周"
                }
            ]
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 将默认数据填入文本框
            document.getElementById('dataInput').value = JSON.stringify(defaultData, null, 2);
            
            // 渲染图表
            renderChart(defaultData);
            
            // 绑定渲染按钮事件
            document.getElementById('renderBtn').addEventListener('click', function() {
                try {
                    const inputData = JSON.parse(document.getElementById('dataInput').value);
                    renderChart(inputData);
                    
                    // 显示成功消息
                    alert('图表渲染成功！');
                } catch (error) {
                    alert('数据格式错误：' + error.message);
                    console.error(error);
                }
            });
        });

        // 渲染图表函数
        function renderChart(data) {
            // 更新标题
            document.getElementById('chart-title').textContent = data.title || '故障数统计图表';
            
            // 准备图表数据
            const ctx = document.getElementById('faultChart').getContext('2d');
            
            // 如果已有图表实例，先销毁
            if (faultChart) {
                faultChart.destroy();
            }
            
            // 定义颜色方案
            const colors = [
                'rgba(59, 130, 246, 0.7)', // 蓝色
                'rgba(16, 185, 129, 0.7)', // 绿色
                'rgba(245, 158, 11, 0.7)', // 橙色
                'rgba(239, 68, 68, 0.7)',  // 红色
                'rgba(139, 92, 246, 0.7)', // 紫色
                'rgba(236, 72, 153, 0.7)'  // 粉色
            ];
            
            // 准备数据集
            const datasets = data.values.map((item, index) => {
                return {
                    label: item.label,
                    data: item.data,
                    backgroundColor: colors[index % colors.length],
                    borderColor: colors[index % colors.length].replace('0.7', '1'),
                    borderWidth: 1,
                    barPercentage: 0.7,
                    categoryPercentage: 0.9
                };
            });
            
            // 处理横坐标显示，长标签自动换行
            const xLabels = data.labels.map(label => {
                // 对长标签进行处理，按分隔符拆分
                return label.replace(/\./g, '\n').replace(/-/g, '\n');
            });
            
            // 创建图表
            faultChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: xLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 8
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    // 显示原始的完整标签（未拆分的）
                                    return data.labels[tooltipItems[0].dataIndex];
                                }
                            }
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: data.xLabel || '分类',
                                font: {
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            },
                            ticks: {
                                maxRotation: 0,
                                font: {
                                    size: 10
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: data.yLabel || '数值',
                                font: {
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            },
                            beginAtZero: true,
                            ticks: {
                                precision: 0 // 确保Y轴只显示整数
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
    </script>
</body>
</html>